<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thiết kế Dự án</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }

    .header {
      background-color: #333;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    .navbar-nav .nav-link {
      color: white !important;
    }

    .main-content {
      margin-top: 20px;
      transition: padding-left 0.3s;
    }

    .progress-bar-container {
      display: flex;
      justify-content: space-around;
      padding: 20px;
      margin-top: 20px;
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .progress-step i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: #007bff;
    }

    .progress-step.active i {
      color: green;
    }

    .project-container {
      display: flex;
      justify-content: space-around;
      padding: 20px;
      height: 500px;
      background-color: white;
      margin-top: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .sidebar .nav-link.active {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }

    .sidebar {
      background-color: #007bff;
      color: white;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      padding: 20px;
      transition: width 0.3s;
    }

    .sidebar.collapsed {
      width: 80px;
    }

    .sidebar .nav-item {
      margin: 20px 0;
    }

    .sidebar .nav-link {
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
    }

    .sidebar .nav-link i {
      margin-right: 10px;
    }

    .sidebar .nav-link:hover {
      text-decoration: underline;
    }

    .sidebar.collapsed .nav-link span {
      display: none;
    }

    .sidebar .collapse-btn {
      background-color: transparent;
      border: none;
      color: white;
      font-size: 1.5rem;
      position: absolute;
      top: 20px;
      right: 20px;
      cursor: pointer;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .sidebar-header img {
      height: 50px;
      transition: height 0.3s;
    }

    .sidebar-header.collapsed img {
      height: 30px;
    }

    .progress-bar-container {
      display: flex;
      justify-content: space-around;
      padding: 20px;
      margin-top: 20px;
    }

    .progress-step.active {
      color: #007bff;
    }

    .project-images {
      width: 70%;
      background-color: #e9ecef;
      padding: 20px;
      border-radius: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }

    .project-images img {
      width: 150px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .project-info {
      width: 25%;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      color: #333;
    }

    .file-upload {
      text-align: center;
      margin-top: 20px;
    }

    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .pagination button {
      background-color: #6c757d;
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      margin: 0 4px;
      cursor: pointer;
    }

    .pagination button:hover {
      background-color: #007bff;
    }
  </style>
</head>

<body>

<div class="header">
  <h1>Quản lý dự án</h1>
</div>

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
  <div class="sidebar-header">
    <img id="logo" src="YOUR_LOGO_URL" alt="Logo" />
    <button class="collapse-btn" onclick="toggleSidebar()"><i class="fas fa-chevron-left"></i></button>
  </div>
  <ul class="nav flex-column">
    <li class="nav-item"><a class="nav-link" href="#" onclick="showContent('home')"><i class="fas fa-home"></i><span>Trang chủ</span></a></li>
    <li class="nav-item"><a class="nav-link" href="#" onclick="showContent('statistics')"><i class="fas fa-chart-line"></i><span>Thống kê</span></a></li>
    <li class="nav-item"><a class="nav-link" href="#" onclick="showContent('inventory')"><i class="fas fa-warehouse"></i><span>Quản lý kho</span></a></li>
    <li class="nav-item"><a class="nav-link" href="delivery.html" onclick="showContent('delivery')"><i class="fas fa-truck"></i><span>Quản lý giao hàng</span></a></li>
    <li class="nav-item"><a class="nav-link active" href="projects.html" onclick="showContent('project-list')"><i class="fas fa-project-diagram"></i><span>Quản lý dự án</span></a></li>
    <li class="nav-item"><a class="nav-link" href="#" onclick="showContent('employees')"><i class="fas fa-users"></i><span>Quản lý nhân viên</span></a></li>
    <li class="nav-item"><a class="nav-link" href="#" onclick="showContent('customers')"><i class="fas fa-user-friends"></i><span>Quản lý khách hàng</span></a></li>
    <li class="nav-item"><a class="nav-link" href="#" onclick="showContent('departments')"><i class="fas fa-building"></i><span>Quản lý phòng ban</span></a></li>
  </ul>
</div>

<div id="contentContainer" class="container main-content" style="padding-left: 250px;">

  <!-- Project Images -->
  <div class="project-container">
    <div class="project-images" id="projectImages">
      <img src="https://via.placeholder.com/150" alt="Design Image">
      <!-- Images will be added dynamically here -->
    </div>

    <!-- Project Info -->
    <div class="project-info" id="projectInfo">
      <h4>Thông tin dự án</h4>
      <p id="projectName">Dự án: </p>
      <p id="customerName">Khách hàng: </p>
      <p id="startDate">Ngày bắt đầu: </p>
      <p id="customerRequirements">Yêu cầu của khách hàng: </p>

      <select class="form-select mt-3" id="approvalSelect">
        <option>Mời chọn phê duyệt hoặc không phê duyệt</option>
        <option>Phê duyệt</option>
        <option>Không phê duyệt</option>
      </select>

      <!-- Nút bấm chuyển sang trang in -->
      <!-- This button triggers redirectToPrint() to go to print page -->
      <button class="btn btn-success mt-3" onclick="redirectToPrint()">In trang này</button>

    </div>
  </div>
</div>

<!-- File Upload and Pagination -->
<div class="file-upload text-center">
  <label for="fileUpload" class="btn btn-primary">Tải file ảnh</label>
  <input type="file" id="fileUpload" style="display: none;" onchange="addImage(event)">
</div>

<script>
  // Sidebar toggle logic
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const logo = document.getElementById('logo');
    const contentContainer = document.getElementById('contentContainer');
    sidebar.classList.toggle('collapsed');

    if (sidebar.classList.contains('collapsed')) {
      contentContainer.style.paddingLeft = '80px';
      logo.classList.add('collapsed');
    } else {
      contentContainer.style.paddingLeft = '250px';
      logo.classList.remove('collapsed');
    }
  }

  // Hàm lấy thông tin Project từ Design ID
  async function fetchProjectByDesignId(projectId, designId) {
    try {
      const response = await fetch(`http://localhost:8080/design/${projectId}/${designId}`);
      if (!response.ok) throw new Error("Failed to fetch project");

      const design = await response.json();
      document.getElementById('projectName').textContent = `Dự án: ${design.projectName}`;
      document.getElementById('customerName').textContent = `Khách hàng: ${design.customerId}`;
      document.getElementById('startDate').textContent = `Ngày bắt đầu: ${design.startDate}`;
      document.getElementById('customerRequirements').textContent = `Yêu cầu của khách hàng: ${design.requestDescriptionFromCustomer}`;
    } catch (error) {
      console.error('Error fetching project data:', error);
    }
  }

  // Gọi hàm khi trang được tải
  document.addEventListener("DOMContentLoaded", () => {
    const projectId = getQueryParam("projectId");
    const designId = getQueryParam("designId");
    if (projectId && designId) {
      fetchProjectByDesignId(projectId, designId);
    }
  });

  // Hàm lấy tham số từ URL
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }


  function addImage(event) {
    const file = event.target.files[0];
    if (file) {
      const projectImages = document.getElementById('projectImages');
      const imgElement = document.createElement('img');
      imgElement.src = URL.createObjectURL(file);
      imgElement.alt = 'Uploaded Image';
      projectImages.appendChild(imgElement);

      // Lưu URL ảnh vào localStorage để chuyển sang trang in
      localStorage.setItem('selectedImageUrl', imgElement.src);
    }
  }

  function redirectToPrint() {
    const projectId = getQueryParam("projectId");
    const designId = getQueryParam("designId");
    if (designId) {
      window.location.href = `print.html?projectId=${projectId}&designId=${designId}`;
    } else {
      alert("Design ID not found.");
    }
  }

  document.getElementById('approvalSelect').addEventListener('change', function() {
    if (this.value === 'Phê duyệt') {
      approveOrRejectDesign(true); // Approve
    } else if (this.value === 'Không phê duyệt') {
      approveOrRejectDesign(false); // Reject
    }
  });

  function approveOrRejectDesign(isApproved) {
    const projectId = getQueryParam("projectId");
    const designId = getQueryParam("designId");
    const endpoint = isApproved ? "approve" : "reject";

    if (designId) {
      fetch(`http://localhost:8080/design/project/${projectId}/${endpoint}/${designId}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        }
      })
              .then(response => {
                if (!response.ok) throw new Error(`Failed to ${isApproved ? 'approve' : 'reject'} design`);
                alert(`Design has been ${isApproved ? 'approved' : 'rejected'} successfully.`);
                redirectToPrint();
              })
              .catch(error => console.error("Error:", error));
    } else {
      alert("Design ID not found.");
    }
  }



</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
